openapi: 3.0.3
info:
  title: StayPost API
  description: |
    StayPostëŠ” ê°ì • ê¸°ë°˜ íœì…˜/ìˆ™ë°•ì—…ì†Œ SNS ì½˜í…ì¸  ìƒì„± í”Œë«í¼ì…ë‹ˆë‹¤.
    ì´ APIëŠ” ì´ë¯¸ì§€ ë¶„ì„, ìº¡ì…˜ ìƒì„±, ë©”íƒ€ë°ì´í„° ìƒì„± ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
  version: 1.1.0
  contact:
    name: StayPost Team
    email: support@staypost.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://staypost.onrender.com
    description: Production server
  - url: http://localhost:5001
    description: Development server
  - url: https://{project}.supabase.co/functions/v1
    description: Supabase Edge Functions
    variables:
      project:
        default: your-project
        description: Your Supabase project ID

security:
  - BearerAuth: []

paths:
  /api/health:
    get:
      summary: Health check
      description: ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ê°„ë‹¨í•œ í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
      tags:
        - Health
      responses:
        '200':
          description: ì„œë²„ê°€ ì •ìƒ ì‘ë™ ì¤‘
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "OK"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-14T12:00:00Z"
        '500':
          description: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/caption:
    post:
      summary: ì´ë¯¸ì§€ ìº¡ì…˜ ìƒì„±
      description: ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ SNSìš© ìº¡ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.
      tags:
        - Caption
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: ë¶„ì„í•  ì´ë¯¸ì§€ íŒŒì¼ë“¤
              required:
                - images
      responses:
        '200':
          description: ìº¡ì…˜ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  captions:
                    type: array
                    items:
                      type: string
                    example:
                      - "A cozy morning at the guesthouse â˜•ï¸"
                      - "Golden hour vibes with stunning architecture âœ¨"
                      - "Perfect blend of comfort and elegance ğŸ¡"
        '400':
          description: íŒŒì¼ì´ ì œê³µë˜ì§€ ì•ŠìŒ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: ìº¡ì…˜ ìƒì„± ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/relight:
    post:
      summary: ì´ë¯¸ì§€ ë¦¬ë¼ì´íŒ…
      description: ClipDrop APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ì˜ ì¡°ëª…ì„ ë³€ê²½í•©ë‹ˆë‹¤.
      tags:
        - Image
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image_file:
                  type: string
                  format: binary
                  description: ì²˜ë¦¬í•  ì´ë¯¸ì§€ íŒŒì¼
                prompt:
                  type: string
                  description: ì¡°ëª… ë³€ê²½ í”„ë¡¬í”„íŠ¸
                  example: "warm sunset lighting"
              required:
                - image_file
                - prompt
      responses:
        '200':
          description: ì´ë¯¸ì§€ ë¦¬ë¼ì´íŒ… ì„±ê³µ
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
        '400':
          description: íŒŒì¼ ë˜ëŠ” í”„ë¡¬í”„íŠ¸ ëˆ„ë½
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: ClipDrop API ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /functions/v1/check-slug-availability:
    post:
      summary: ìŠ¬ëŸ¬ê·¸ ì‚¬ìš© ê°€ëŠ¥ì„± í™•ì¸
      description: ìŠ¤í† ì–´ ìŠ¬ëŸ¬ê·¸ì˜ ì‚¬ìš© ê°€ëŠ¥ì„±ì„ í™•ì¸í•©ë‹ˆë‹¤.
      tags:
        - Store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                slug:
                  type: string
                  description: í™•ì¸í•  ìŠ¬ëŸ¬ê·¸
                  example: "my-store-name"
              required:
                - slug
      responses:
        '200':
          description: ìŠ¬ëŸ¬ê·¸ í™•ì¸ ì„±ê³µ
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    properties:
                      available:
                        type: boolean
                        example: true
                  - type: object
                    properties:
                      available:
                        type: boolean
                        example: false
                      suggestedSlug:
                        type: string
                        example: "my-store-name-1"
        '400':
          description: ìœ íš¨í•˜ì§€ ì•Šì€ ìŠ¬ëŸ¬ê·¸
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '405':
          description: í—ˆìš©ë˜ì§€ ì•ŠëŠ” HTTP ë©”ì„œë“œ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /functions/v1/create-store:
    post:
      summary: ìŠ¤í† ì–´ ìƒì„±
      description: ìƒˆë¡œìš´ ìŠ¤í† ì–´ í”„ë¡œí•„ì„ ìƒì„±í•©ë‹ˆë‹¤.
      tags:
        - Store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                storeName:
                  type: string
                  description: ìŠ¤í† ì–´ ì´ë¦„
                  example: "My Beautiful Guesthouse"
                slug:
                  type: string
                  description: ìŠ¤í† ì–´ ìŠ¬ëŸ¬ê·¸
                  example: "my-beautiful-guesthouse"
              required:
                - storeName
                - slug
      responses:
        '200':
          description: ìŠ¤í† ì–´ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  store:
                    $ref: '#/components/schemas/Store'
        '400':
          description: ìœ íš¨í•˜ì§€ ì•Šì€ ì…ë ¥ê°’
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '405':
          description: í—ˆìš©ë˜ì§€ ì•ŠëŠ” HTTP ë©”ì„œë“œ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: ìŠ¬ëŸ¬ê·¸ ì¤‘ë³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /functions/v1/generate-final-caption:
    post:
      summary: ìµœì¢… ìº¡ì…˜ ìƒì„±
      description: ì´ë¯¸ì§€ì™€ ìŠ¤íƒ€ì¼ í”„ë¡œí•„ì„ ê¸°ë°˜ìœ¼ë¡œ SNS ìº¡ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.
      tags:
        - Caption
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                image_url:
                  type: string
                  description: ì´ë¯¸ì§€ URL ë˜ëŠ” Base64 ë°ì´í„°
                  example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                style_profile:
                  type: object
                  description: AI ìŠ¤íƒ€ì¼ ë¶„ì„ ê²°ê³¼ ë° ì‚¬ìš©ì ì¡°ì • ì„¤ì •
                  properties:
                    emotion:
                      type: string
                      description: ì£¼ìš” ê°ì •
                      enum: ["ì„¤ë ˜", "í‰ì˜¨", "ì¦ê±°ì›€", "ë¡œë§¨í‹±", "íë§"]
                      example: "í‰ì˜¨"
                    emotion_level:
                      type: string
                      description: ê°ì • ê°•ë„
                      enum: ["low", "medium", "high"]
                      example: "medium"
                    tone:
                      type: string
                      description: í†¤ ìŠ¤íƒ€ì¼
                      enum: ["friendly", "formal", "casual", "luxury"]
                      example: "friendly"
                    context:
                      type: string
                      description: íƒ€ê²Ÿ ì»¨í…ìŠ¤íŠ¸
                      enum: ["customer", "business", "family", "couple", "luxury"]
                      example: "customer"
                    rhythm:
                      type: string
                      description: ê¸€ì“°ê¸° ë¦¬ë“¬
                      enum: ["fast", "balanced", "slow"]
                      example: "balanced"
                    self_projection:
                      type: string
                      description: ìê¸° íˆ¬ì˜ ìˆ˜ì¤€
                      enum: ["low", "medium", "high"]
                      example: "medium"
                    vocab_color:
                      type: object
                      description: ì–´íœ˜ ìƒ‰ê¹” ì„¤ì •
                      properties:
                        generation:
                          type: string
                          description: ì„¸ëŒ€ë³„ ì–´íœ˜
                          enum: ["genX", "genY", "genZ"]
                          example: "genY"
                        genderStyle:
                          type: string
                          description: ì„±ë³„ ìŠ¤íƒ€ì¼
                          enum: ["neutral", "feminine", "masculine"]
                          example: "neutral"
                        internetLevel:
                          type: string
                          description: ì¸í„°ë„· ìˆ˜ì¤€
                          enum: ["none", "light", "heavy"]
                          example: "light"
                  required:
                    - emotion
                    - tone
                    - context
                    - rhythm
              required:
                - image_url
                - style_profile
      responses:
        '200':
          description: ìº¡ì…˜ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  hook:
                    type: string
                    description: ë§¤ë ¥ì ì¸ ì²« ë¬¸ì¥ (15ì ì´ë‚´)
                    example: "ì´ê³³ì—ì„œ ê¿ˆê¾¸ë˜ íœ´ì‹"
                  caption:
                    type: string
                    description: ë³¸ë¬¸ ìº¡ì…˜
                    example: "í†µìœ ë¦¬ì°½ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ë¹›, ì˜¤ëŠ˜ì˜ ì†ë„ë¥¼ ì ì‹œ ëŠ¦ì¶°ë³´ì„¸ìš”."
                  hashtags:
                    type: array
                    items:
                      type: string
                    description: í•´ì‹œíƒœê·¸ ë°°ì—´ (5-10ê°œ)
                    example: ["#íœì…˜", "#íë§", "#ë·°ë§›ì§‘", "#ì»¤í”Œì—¬í–‰"]
                  style_analysis:
                    type: object
                    description: AIê°€ ìŠ¤íƒ€ì¼ í”„ë¡œí•„ì„ ì–´ë–»ê²Œ í™œìš©í–ˆëŠ”ì§€ ì„¤ëª…
                    properties:
                      emotion_usage:
                        type: string
                        description: ê°ì •ê³¼ ê°•ë„ í™œìš© ì„¤ëª…
                        example: "í‰ì˜¨í•œ ê°ì •ì„ ë¶€ë“œëŸ¬ìš´ ì–´ì¡°ë¡œ í‘œí˜„í•˜ì—¬ í¸ì•ˆí•œ ë¶„ìœ„ê¸°ë¥¼ ì¡°ì„±í–ˆìŠµë‹ˆë‹¤."
                      tone_usage:
                        type: string
                        description: í†¤ í™œìš© ì„¤ëª…
                        example: "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ ë”°ëœ»í•˜ê³  í¸ì•ˆí•œ ëŠë‚Œì„ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤."
                      context_usage:
                        type: string
                        description: ì»¨í…ìŠ¤íŠ¸ í™œìš© ì„¤ëª…
                        example: "ì¼ë°˜ ê³ ê°ì„ ëŒ€ìƒìœ¼ë¡œ í•œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë©”ì‹œì§€ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤."
                      rhythm_usage:
                        type: string
                        description: ë¦¬ë“¬ í™œìš© ì„¤ëª…
                        example: "ê· í˜•ì¡íŒ ë¦¬ë“¬ìœ¼ë¡œ ì½ê¸° í¸í•œ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤."
                      projection_usage:
                        type: string
                        description: ìê¸° íˆ¬ì˜ í™œìš© ì„¤ëª…
                        example: "ì ë‹¹í•œ ê°ì • ì´ì…ìœ¼ë¡œ ê³ ê°ì´ ê²½í—˜í•  ìˆ˜ ìˆëŠ” ê°ì •ì„ ìƒìƒí•˜ê²Œ ë¬˜ì‚¬í–ˆìŠµë‹ˆë‹¤."
                      vocab_usage:
                        type: string
                        description: ì–´íœ˜ ìƒ‰ê¹” í™œìš© ì„¤ëª…
                        example: "Yì„¸ëŒ€ì— ì í•©í•œ ì¹œê·¼í•˜ë©´ì„œë„ ì„¸ë ¨ëœ ì–´íœ˜ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤."
        '400':
          description: í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: OpenAI í‚¤ ëˆ„ë½ ë˜ëŠ” ë‚´ë¶€ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /functions/v1/generate-image-meta:
    post:
      summary: ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° ìƒì„±
      description: ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ë§ˆì¼€íŒ…ìš© ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      tags:
        - Image
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                imageBase64:
                  type: string
                  description: Base64ë¡œ ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ ë°ì´í„°
                  example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
              required:
                - imageBase64
      responses:
        '200':
          description: ë©”íƒ€ë°ì´í„° ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  main_features:
                    type: array
                    items:
                      type: string
                    description: ì£¼ìš” íŠ¹ì§•ë“¤
                    example: ["ë°”ë‹¤", "ìˆ˜ì˜ì¥", "ë…¸ì„", "ì‚°", "ì •ì›"]
                  view_type:
                    type: string
                    description: ë·° íƒ€ì…
                    example: "ì˜¤ì…˜ë·°"
                  emotions:
                    type: array
                    items:
                      type: string
                    description: ê°ì •ì  ë¶„ìœ„ê¸°
                    example: ["ê°ì„± íë§", "ëŸ­ì…”ë¦¬í•¨", "ì—¬ìœ ë¡œì›€"]
                  hashtags:
                    type: array
                    items:
                      type: string
                    description: ì¶”ì²œ í•´ì‹œíƒœê·¸
                    example: ["#ì œì£¼ë„íœì…˜", "#ì˜¤ì…˜ë·°ìˆ™ì†Œ", "#í’€ë¹Œë¼ì¶”ì²œ"]
        '401':
          description: ì¸ì¦ ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '400':
          description: ì´ë¯¸ì§€ ë°ì´í„° ëˆ„ë½
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: OpenAI API ì˜¤ë¥˜ ë˜ëŠ” ë©”íƒ€ë°ì´í„° ìƒì„± ì‹¤íŒ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase JWT í† í°

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: ì—ëŸ¬ ì½”ë“œ
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: ì—ëŸ¬ ë©”ì‹œì§€
          example: "Invalid input data"
        details:
          type: object
          description: ìƒì„¸ ì—ëŸ¬ ì •ë³´

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: "VALIDATION_ERROR"
        details:
          type: object
          properties:
            fieldErrors:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
              example:
                emotion: ["Emotion is required"]

    Store:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ìŠ¤í† ì–´ ID
          example: "123e4567-e89b-12d3-a456-426614174000"
        store_name:
          type: string
          description: ìŠ¤í† ì–´ ì´ë¦„
          example: "My Beautiful Guesthouse"
        slug:
          type: string
          description: ìŠ¤í† ì–´ ìŠ¬ëŸ¬ê·¸
          example: "my-beautiful-guesthouse"
        created_at:
          type: string
          format: date-time
          description: ìƒì„± ì‹œê°„
          example: "2024-01-01T00:00:00.000Z"

    EmotionCard:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ê°ì • ì¹´ë“œ ID
        image_url:
          type: string
          description: ì´ë¯¸ì§€ URL
        caption:
          type: string
          description: ìº¡ì…˜
        emotion:
          type: string
          enum: ["ì„¤ë ˜", "í‰ì˜¨", "ì¦ê±°ì›€", "ë¡œë§¨í‹±", "íë§"]
          description: ì„ íƒëœ ê°ì •
        template_id:
          type: string
          description: í…œí”Œë¦¿ ID
        store_slug:
          type: string
          description: ìŠ¤í† ì–´ ìŠ¬ëŸ¬ê·¸
        seo_title:
          type: string
          description: SEO ì œëª©
        seo_keywords:
          type: array
          items:
            type: string
          description: SEO í‚¤ì›Œë“œ
        seo_hashtags:
          type: array
          items:
            type: string
          description: SEO í•´ì‹œíƒœê·¸
        created_at:
          type: string
          format: date-time
          description: ìƒì„± ì‹œê°„

    Reservation:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ì˜ˆì•½ ID
        store_slug:
          type: string
          description: ìŠ¤í† ì–´ ìŠ¬ëŸ¬ê·¸
        date:
          type: string
          format: date
          description: ì˜ˆì•½ ë‚ ì§œ
        time:
          type: string
          format: time
          description: ì˜ˆì•½ ì‹œê°„
        person_count:
          type: integer
          minimum: 1
          maximum: 20
          description: ì¸ì› ìˆ˜
        name:
          type: string
          description: ì˜ˆì•½ì ì´ë¦„
        phone:
          type: string
          description: ì—°ë½ì²˜
        request:
          type: string
          description: íŠ¹ë³„ ìš”ì²­ì‚¬í•­
        created_at:
          type: string
          format: date-time
          description: ì˜ˆì•½ ìƒì„± ì‹œê°„

tags:
  - name: Health
    description: í—¬ìŠ¤ ì²´í¬ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸
  - name: Caption
    description: ìº¡ì…˜ ìƒì„± ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸
  - name: Image
    description: ì´ë¯¸ì§€ ì²˜ë¦¬ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸
  - name: Store
    description: ìŠ¤í† ì–´ ê´€ë¦¬ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸
  - name: Auth
    description: ì¸ì¦ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸

# Changelog
# 2025-01-15: Initial OpenAPI specification
# 2025-01-15: Added Edge Functions endpoints
# 2025-01-15: Updated API structure and documentation
